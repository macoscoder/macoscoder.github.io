<!DOCTYPE html>
<html lang="zh-cn">
<title>进程时间 | 我的博客</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.60.1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="canonical" href="http://flyblog.tech/posts/unix-process-time/">
<link rel="alternate" type="application/rss+xml" href="" title="我的博客">
<link rel="stylesheet" href="http://flyblog.tech/css/theme.css">
<link rel="stylesheet" href="http://flyblog.tech/css/classes.css">

<header class="dark">
  <h2><a href="http://flyblog.tech/">我的博客</a></h2>
  <nav>
    
  </nav>
</header>

<article>
  <header>
    <h1>进程时间</h1>
    <p><time datetime="2011-12-23T13:05:31Z">December 23, 2011</time></p>
  </header>
  <h1 id="heading">进程时间</h1>
<h2 id="heading1">概述</h2>
<p>进程时间是指进程消耗的CPU时间，分为</p>
<ul>
<li>user cpu time</li>
<li>system cpu time</li>
</ul>
<h2 id="times">times系统调用</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;sys/times.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>clock_t <span style="color:#a6e22e">times</span>(<span style="color:#66d9ef">struct</span> tms <span style="color:#f92672">*</span>buf);
</code></pre></div><h2 id="heading2">示例</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;sys/times.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;unistd.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">long</span> <span style="color:#66d9ef">long</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10000000</span>; i<span style="color:#f92672">+</span><span style="color:#f92672">+</span>) {
        getpid();
    }
    <span style="color:#66d9ef">int</span> CLK_TCK <span style="color:#f92672">=</span> sysconf(_SC_CLK_TCK); <span style="color:#75715e">// USER_HZ
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">struct</span> tms tms;
    times(<span style="color:#f92672">&amp;</span>tms);
    <span style="color:#66d9ef">double</span> utime <span style="color:#f92672">=</span> (<span style="color:#66d9ef">double</span>)tms.tms_utime <span style="color:#f92672">/</span> CLK_TCK;
    <span style="color:#66d9ef">double</span> stime <span style="color:#f92672">=</span> (<span style="color:#66d9ef">double</span>)tms.tms_stime <span style="color:#f92672">/</span> CLK_TCK;
    printf(
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">user:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%.3fs</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">sys:</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">%.3fs</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,
        utime, stime);
}
</code></pre></div><h3 id="heading3">演示</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ cc time.c
$ time ./a.out
user:   1.160s
sys:    1.460s

real    0m2.642s
user    0m1.169s
sys     0m1.463s
</code></pre></div><h2 id="clock">clock库函数</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#</span><span style="color:#75715e">include</span> <span style="color:#75715e">&lt;time.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>clock_t <span style="color:#a6e22e">clock</span>(<span style="color:#66d9ef">void</span>);
</code></pre></div><p><code>clock</code>库函数获取的是进程的<strong>user cpu time</strong>和<strong>system cpu time</strong>之和</p>
<p>虽然<code>clock</code>和<code>times</code>的返回值类型相同，但是由于历史原因<code>clock</code>返回的值的单位与<code>times</code>不同<br>
要转换成秒，<code>clock</code>返回的值需要除以<code>CLOCKS_PER_SEC</code>，这个值固定为<strong>1000000</strong></p>
<p>由于通过<code>times</code>系统调用可以计算出总的cpu时间，所以<strong>不推荐</strong>使用<code>clock</code>函数</p>

</article>



</html>
