<!DOCTYPE html>
<html lang="zh-cn">
<title>ss | 我的博客</title>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.60.1" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="canonical" href="http://flyblog.tech/posts/ss/">
<link rel="alternate" type="application/rss+xml" href="" title="我的博客">
<link rel="stylesheet" href="http://flyblog.tech/css/theme.css">
<link rel="stylesheet" href="http://flyblog.tech/css/classes.css">

<header class="dark">
  <h2><a href="http://flyblog.tech/">我的博客</a></h2>
  <nav>
    
  </nav>
</header>

<article>
  <header>
    <h1>ss</h1>
    <p><time datetime="2011-12-23T13:05:31Z">December 23, 2011</time></p>
  </header>
  <h1 id="ss">ss</h1>
<p>ss is used to dump socket statistics.</p>
<h2 id="synopsis">SYNOPSIS</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ss <span style="color:#f92672">[</span>OPTIONS<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>STATE-FILTER<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>ADDRESS-FILTER<span style="color:#f92672">]</span>
</code></pre></div><h2 id="options">OPTIONS</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">-n, --numeric
    Do not try to resolve service names.
-r, --resolve
    Try to resolve numeric address/ports.
-a, --all
    Display both listening and non-listening sockets.
-l, --listening
    Display only listening sockets.
-p, --processes
    Show process using socket.
-K, --kill
    Attempts to forcibly close sockets.
-4, --ipv4
    Display only IP version <span style="color:#ae81ff">4</span> sockets <span style="color:#f92672">(</span>alias <span style="color:#66d9ef">for</span> -f inet<span style="color:#f92672">)</span>.
-6, --ipv6
    Display only IP version <span style="color:#ae81ff">6</span> sockets <span style="color:#f92672">(</span>alias <span style="color:#66d9ef">for</span> -f inet6<span style="color:#f92672">)</span>.
-0, --packet
    Display PACKET sockets <span style="color:#f92672">(</span>alias <span style="color:#66d9ef">for</span> -f link<span style="color:#f92672">)</span>.
-t, --tcp
    Display TCP sockets.
-u, --udp
    Display UDP sockets.
-d, --dccp
    Display DCCP sockets.
-w, --raw
    Display RAW sockets.
-x, --unix
    Display Unix domain sockets <span style="color:#f92672">(</span>alias <span style="color:#66d9ef">for</span> -f unix<span style="color:#f92672">)</span>.
-S, --sctp
    Display SCTP sockets.
-f FAMILY, --family<span style="color:#f92672">=</span>FAMILY
    Display sockets of type FAMILY. Currently the following families are supported: unix, inet, inet6, link, netlink.
</code></pre></div><h2 id="statefilter">STATE-FILTER</h2>
<p>ss allows to filter socket states, using keywords <code>state</code> and <code>exclude</code>, followed by some <code>state identifier</code>.</p>
<p><code>exclude</code> 可以简写成 <code>excl</code></p>
<p>状态过滤器格式:</p>
<p><code>state|exclude stateid1 state|exclude stateid2 ...</code></p>
<p><code>state identifier</code> 有:</p>
<ul>
<li>established</li>
<li>syn-sent</li>
<li>syn-recv</li>
<li>fin-wait-1</li>
<li>fin-wait-2</li>
<li>time-wait</li>
<li>closed</li>
<li>close-wait</li>
<li>last-ack</li>
<li>listening</li>
<li>closing</li>
<li>all</li>
<li>connected</li>
<li>synchronized</li>
<li>bucket</li>
<li>big</li>
</ul>
<p>默认情况下不加任何选项相当于</p>
<p><code>state all exclude listening exclude syn-recv exclude time-wait exclude closed</code></p>
<p><code>-a</code>选项相当于 <code>state all</code></p>
<p>debian 9 ss(8)手册有个错误，<code>listen</code>应为<code>listening</code></p>
<p>see <a href="http://man7.org/linux/man-pages/man8/ss.8.html"><a href="http://man7.org/">http://man7.org/</a></a></p>
<h2 id="addressfilter">ADDRESS-FILTER</h2>
<p>地址过滤器形成一个布尔表达式，格式如下:</p>
<p><code>predicate1 OP predicate2 ...</code></p>
<p><code>predicate</code> 有</p>
<ul>
<li>dst ADDRESS_PATTERN - matches remote address and port</li>
<li>src ADDRESS_PATTERN - matches local address and port</li>
<li>dport RELOP PORT - compares remote port to a number</li>
<li>sport RELOP PORT - compares local port to a number</li>
<li>autobound - checks that socket is bound to an ephemeral port</li>
</ul>
<p>逻辑操作符(<code>OP</code>) 有</p>
<ul>
<li>and</li>
<li>or</li>
<li>not</li>
</ul>
<p>关系操作符(<code>RELOP</code>) 有</p>
<ul>
<li>le</li>
<li>ge</li>
<li>eq</li>
<li>ne</li>
<li>gt</li>
<li>lt</li>
</ul>
<p><code>ADDRESS_PATTERN</code>格式</p>
<ol>
<li>IPv4地址格式
ip:port</li>
<li>IPv6地址格式
[ip]:port</li>
<li>unix地址格式
path</li>
</ol>
<p>上述的ip或port可省略其一</p>
<h2 id="examples">EXAMPLES</h2>
<h3 id="statefilter-">STATE-FILTER 示例</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ss -t state listening state time-wait
ss -x state listening
ss -t excl listening
</code></pre></div><h3 id="addressfilter-">ADDRESS-FILTER 示例</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ss -a src :443
Netid State      Recv-Q Send-Q                  Local Address:Port                                   Peer Address:Port
tcp   LISTEN     <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">128</span>                                :::https                                            :::*
tcp   ESTAB      <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span>               ::ffff:67.216.219.154:https                          ::ffff:1.180.238.165:14694
</code></pre></div><p>443是https服务</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ ss -a src <span style="color:#f92672">[</span>::ffff:67.216.219.154<span style="color:#f92672">]</span>
Netid State      Recv-Q Send-Q                  Local Address:Port                                   Peer Address:Port
tcp   ESTAB      <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span>               ::ffff:67.216.219.154:https                          ::ffff:1.180.238.165:24022
tcp   LAST-ACK   <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">1</span>               ::ffff:67.216.219.154:9999                           ::ffff:1.180.238.165:43113
tcp   LAST-ACK   <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">1</span>               ::ffff:67.216.219.154:9999                           ::ffff:1.180.238.165:28346
tcp   ESTAB      <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span>               ::ffff:67.216.219.154:9999                           ::ffff:1.180.238.165:11740
tcp   ESTAB      <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span>               ::ffff:67.216.219.154:https                          ::ffff:1.180.238.165:14694
tcp   ESTAB      <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span>               ::ffff:67.216.219.154:http                           ::ffff:1.180.238.165:21362
tcp   ESTAB      <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span>               ::ffff:67.216.219.154:9999                           ::ffff:1.180.238.165:40387
tcp   LAST-ACK   <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">1</span>               ::ffff:67.216.219.154:9999                           ::ffff:1.180.238.165:34051
tcp   LAST-ACK   <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">1</span>               ::ffff:67.216.219.154:9999                           ::ffff:1.180.238.165:18873
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ss -a sport eq http or sport eq https
</code></pre></div><p>上述命令列出所有http和https socket</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ss -ax src <span style="color:#e6db74">&#39;/run/systemd/journal/*&#39;</span>
</code></pre></div><p>上述的路径需要加引号，防止被shell扩展</p>
<h2 id="heading">参考资料</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo apt install iproute2-doc
$ dpkg-query -L iproute2-doc | grep ss.html
/usr/share/doc/iproute2-doc/ss.html
</code></pre></div>
</article>



</html>
